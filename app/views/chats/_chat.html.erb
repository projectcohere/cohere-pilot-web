<article class="<%= cx(local_assigns[:class], "Chat Phone-frame") %>">
  <%- data = { sender: sender, receiver: receiver } %>
  <%- data.merge!(local_assigns[:data] || {}) %>

  <div class="Chat-window">
    <%= tag.ol(id: "chat", class: "Chat-messages", data: data) do %>
      <%- chat.messages.each do |msg| %>
        <%- msg.attachments.each do |a| %>
          <%= chat_message_tag(msg, sender, receiver) do %>
            <img
              class="ChatMessage-attachment"
              alt="<%= a.filename %>"
              src="<%= a.representable? ? a.representation(resize: "200x200>").processed.service_url : nil %>"
            />
          <%- end %>
        <%- end %>

        <%- if msg.body.present? %>
          <%= chat_message_tag(msg, sender, receiver) do %>
            <p class="ChatMessage-body">
              <%= msg.body %>
            </p>
          <%- end %>
        <%- end %>
      <%- end %>
    <%- end %>

    <%= form_for(:chat, html: { id: "chat-form", class: "Chat-form" }) do |f| %>
      <ol id="chat-files" class="Chat-files is-empty"></ol>

      <div class="Chat-controls">
        <div class="Chat-field">
          <span id="chat-input" contenteditable="true" class="Chat-input"></span>
          <span class="Chat-placeholder">Enter your message...</span>
        </div>

        <label class="Chat-addFile">
          <input id="chat-file-input" type="file" multiple="true" />
        </label>
        <button class="Chat-send" alt="Send Message"></button>
      </div>
    <% end %>
  </div>
</article>
