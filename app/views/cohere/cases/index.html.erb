<main class="Main">
  <header class="Main-header">
    <h1 class="Main-title">
      <%= @scope.name %> Cases
    </h1>

    <%= totals_for(@page, of: "cases") %>

    <div class="Main-filters">
      <nav class="Filters">
        <%- s = Cohere::CaseScope %>
        <%= cases_filter_link_to(s::Queued) %>
        <%= cases_filter_link_to(s::Open) %>
        <%= cases_filter_link_to(s::Completed) %>
      </nav>
    </div>
  </header>

  <%= tag.ul(cases_list_options) do %>
    <% if @cases&.blank? %>
      <h2 class="CaseList-fallback">
        No <%= @scope %> cases left.
      </h2>
    <% else %>
      <% @cases.each do |kase| %>
        <%- view = Cases::View.new(kase) %>
        <%= tag.li(cases_cell_options(view)) do %>
          <div class="CaseCell-row">
            <%- link_path = if cases_is_open %>
            <%-   edit_case_path(kase) %>
            <%- else %>
            <%-   case_path(kase) %>
            <%- end %>

            <%= link_to(view.recipient_name, link_path, action: :edit, class: "CaseCell-name") %>

            <%- if cases_is_open %>
              <span class="CaseCell-activity"></span>
            <%- end %>
          </div>

          <div class="CaseCell-row">
            <p class="CaseCell-organizations">
              <%= view.program_name %>, <%= view.supplier_name %>, <%= view.enroller_name %>
            </p>
          </div>

          <div class="CaseCell-row">
            <p class="CaseCell-status">
              <%= view.status %>
            </p>
            <p class="CaseCell-updateTime">
              Updated <%= time_ago_in_words(view.updated_at) %> ago
            </p>
          </div>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <%= pager_for(@page, of: "cases") %>
</main>
