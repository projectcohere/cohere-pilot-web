<%# -- helpers -- %>
<% filter_link_to = ->(scope) do %>
<%   link_class = "Filter #{@scope == scope && "is-selected"}" %>
<%   link_to(scope.titlecase, "#{cases_path}/#{scope}", class: link_class) %>
<% end %>

<%# -- template -- %>
<main class="Main">
  <header class="Main-header">
    <h1 class="Main-title">
      <%= @scope.titlecase %> Cases
    </h1>
    <div class="Main-filters">
      <nav class="Filters">
        <%= filter_link_to.(Cohere::CaseScope::Open) %>
        <%= filter_link_to.(Cohere::CaseScope::Completed) %>
      </nav>
    </div>
  </header>

  <%- is_open_cases = @scope == Cohere::CaseScope::Open %>
  <%= tag.ul(class: "CaseList", id: is_open_cases ? "case-list" : "") do %>
    <% if @cases&.blank? %>
      <h2 class="CaseList-fallback">
        No <%= @scope %> cases left.
      </h2>
    <% else %>
      <% @cases.each do |kase| %>
        <%- view = Cases::View.new(kase) %>
        <li class="CaseCell">
          <div class="CaseCell-row">
            <%- link_path = if @scope == "open" %>
            <%-   edit_case_path(kase) %>
            <%- else %>
            <%-   case_path(kase) %>
            <%- end %>

            <%= link_to(view.recipient_name, link_path, action: :edit, class: "CaseCell-name") %>

            <%- if is_open_cases %>
              <%= tag.span("", class: view.has_new_activity ? "CaseCell-active" : "") %>
            <%- end %>
          </div>
          <div class="CaseCell-row">
            <p class="CaseCell-organizations">
              <%= view.program_name %>, <%= view.supplier_name %>, <%= view.enroller_name %>
            </p>
          </div>
          <div class="CaseCell-row">
            <p class="CaseCell-status">
              <%= view.status %>
            </p>
            <p class="CaseCell-updateTime">
              Updated <%= time_ago_in_words(view.updated_at) %> ago
            </p>
          </div>
        </li>
      <% end %>
    <% end %>
  <% end %>
</main>
